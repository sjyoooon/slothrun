<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>ë¯¸ë‹ˆ ë‹¤ì´ë…¸ëŸ° (Rect)</title>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #000000;
      --danger: #e53935;
      --hud: #222;
      --hud-bg: rgba(255,255,255,0.8);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Arial, Apple SD Gothic Neo, "ë§‘ì€ ê³ ë”•", sans-serif;
      display: grid;
      place-items: center;
      height: 100dvh;
    }
    .wrap {
      position: relative;
      width: min(960px, 100vw);
      padding: 12px;
    }
    canvas {
      width: 100%;
      height: auto;
      display: block;
      border: 1px solid #ddd;
      background: var(--bg);
      touch-action: manipulation;
    }
    .hud {
      pointer-events: none;
      position: absolute;
      top: 16px; left: 16px; right: 16px;
      display: flex; justify-content: space-between; align-items: center;
      font-weight: 700; font-variant-numeric: tabular-nums;
      color: var(--hud);
      text-shadow: 0 1px 0 #fff;
    }
    .badge {
      background: var(--hud-bg);
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #e6e6e6;
    }
    .center-ui {
      position: absolute; inset: 0;
      display: grid; place-items: center;
    }
    .btn {
      appearance: none; border: 0; cursor: pointer;
      padding: 12px 16px; border-radius: 10px;
      background: #111; color: #fff; font-weight: 700;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .btn:active { transform: translateY(1px); }
    .tip {
      position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
      font-size: 12px; opacity: .65;
      background: var(--hud-bg); padding: 4px 8px; border-radius: 6px; border: 1px solid #eee;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- ì¢Œìƒë‹¨: ìµœê³ ì  / ìš°ìƒë‹¨: í˜„ì¬ì ìˆ˜ -->
    <div class="hud">
      <div id="highScore" class="badge">ìµœê³ ì : 0</div>
      <div id="score" class="badge">ì ìˆ˜: 0</div>
    </div>

    <canvas id="game" width="900" height="260" aria-label="Dino Run"></canvas>

    <div class="center-ui" id="overlay" style="display:none;">
      <button id="restartBtn" class="btn">ì¬ì‹œì‘</button>
      <div class="tip">ì í”„: ìŠ¤í˜ì´ìŠ¤/â†‘í‚¤ ë˜ëŠ” í™”ë©´ íƒ­</div>
    </div>
  </div>

  <script>
    // ===============================
    // ğŸ”§ ì„¤ì •ê°’: ì—¬ê¸°ë§Œ ìˆ˜ì •í•˜ë©´ ë¨
    // ===============================
    const CONFIG = {
      GAME_WIDTH: 900,
      GAME_HEIGHT: 260,

      GROUND_Y: 220,                // ì§€ë©´ Y (ìº”ë²„ìŠ¤ ìƒë‹¨ ê¸°ì¤€)
      DINO_X: 60,                   // ê³µë£¡ ì‹œì‘ X
      DINO_WIDTH: 36,
      DINO_HEIGHT: 42,
      DINO_COLOR: "#000000",

      JUMP_VELOCITY: -520,          // ì í”„ ì´ˆê¸° ì†ë„ (px/s, ìŒìˆ˜ëŠ” ìœ„ë¡œ)
      GRAVITY: 1600,                // ì¤‘ë ¥ ê°€ì†ë„ (px/s^2)

      SPEED_START: 280,             // ì´ˆê¸° ì§„í–‰ ì†ë„ (px/s)
      SPEED_ACCEL_PER_SEC: 18,      // ì´ˆë‹¹ ê°€ì† (px/s^2)
      SPEED_MAX: 780,               // ìµœëŒ€ ì†ë„ (ìƒí•œ)

      OBST_MIN_GAP: 220,            // ì¥ì• ë¬¼ ê°„ ìµœì†Œ ê°„ê²© (px)
      OBST_MAX_GAP: 420,            // ì¥ì• ë¬¼ ê°„ ìµœëŒ€ ê°„ê²© (px)
      OBST_MIN_WIDTH: 16,
      OBST_MAX_WIDTH: 36,
      OBST_MIN_HEIGHT: 30,
      OBST_MAX_HEIGHT: 60,
      OBST_COLOR: "#e53935",

      SCORE_PER_OBSTACLE: 10,       // ì¥ì• ë¬¼ 1ê°œ í†µê³¼ë‹¹ ì ìˆ˜
      HIGH_SCORE_KEY: "dinoHighScoreRectV1"
    };

    // ===============================
    // ë‚´ë¶€ ìƒíƒœ
    // ===============================
    const cvs = document.getElementById("game");
    const ctx = cvs.getContext("2d");
    const scoreEl = document.getElementById("score");
    const highScoreEl = document.getElementById("highScore");
    const overlay = document.getElementById("overlay");
    const restartBtn = document.getElementById("restartBtn");

    // ìº”ë²„ìŠ¤ ê³ ì • í•´ìƒë„ ìœ ì§€
    cvs.width = CONFIG.GAME_WIDTH;
    cvs.height = CONFIG.GAME_HEIGHT;

    const state = {
      running: false,
      dead: false,
      speed: CONFIG.SPEED_START,
      time: 0,
      lastTime: 0,
      distSinceLast: 0,
      score: 0,
      highScore: Number(localStorage.getItem(CONFIG.HIGH_SCORE_KEY) || 0)
    };

    // í”Œë ˆì´ì–´(ê³µë£¡) & ì¥ì• ë¬¼
    const dino = {
      x: CONFIG.DINO_X,
      y: CONFIG.GROUND_Y - CONFIG.DINO_HEIGHT,
      w: CONFIG.DINO_WIDTH,
      h: CONFIG.DINO_HEIGHT,
      vy: 0,
      onGround: true
    };

    /** @type {Array<{x:number,y:number,w:number,h:number,scored?:boolean}>} */
    let obstacles = [];

    // ===============================
    // ìœ í‹¸
    // ===============================
    function randInt(a, b) {
      return Math.floor(Math.random() * (b - a + 1)) + a;
    }

    function clamp(v, a, b) {
      return Math.max(a, Math.min(b, v));
    }

    function rectsOverlap(ax, ay, aw, ah, bx, by, bw, bh) {
      return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
    }

    function resetGame() {
      state.running = true;
      state.dead = false;
      state.speed = CONFIG.SPEED_START;
      state.time = 0;
      state.lastTime = performance.now();
      state.distSinceLast = 0;
      state.score = 0;

      dino.x = CONFIG.DINO_X;
      dino.y = CONFIG.GROUND_Y - CONFIG.DINO_HEIGHT;
      dino.vy = 0;
      dino.onGround = true;

      obstacles = [];
      overlay.style.display = "none";
      scoreEl.textContent = `ì ìˆ˜: ${state.score}`;
      highScoreEl.textContent = `ìµœê³ ì : ${state.highScore}`;
      requestAnimationFrame(loop);
    }

    function gameOver() {
      state.dead = true;
      state.running = false;

      if (state.score > state.highScore) {
        state.highScore = state.score;
        localStorage.setItem(CONFIG.HIGH_SCORE_KEY, String(state.highScore));
      }
      highScoreEl.textContent = `ìµœê³ ì : ${state.highScore}`;
      overlay.style.display = "grid";
    }

    function trySpawnObstacle() {
      // ì¼ì • ê±°ë¦¬ ì´ìƒ ì§„í–‰ ì‹œ ìŠ¤í°
      if (state.distSinceLast < randGap) return;

      const w = randInt(CONFIG.OBST_MIN_WIDTH, CONFIG.OBST_MAX_WIDTH);
      const h = randInt(CONFIG.OBST_MIN_HEIGHT, CONFIG.OBST_MAX_HEIGHT);
      const x = CONFIG.GAME_WIDTH + w; // ì˜¤ë¥¸ìª½ ë°”ê¹¥ì—ì„œ ë“±ì¥
      const y = CONFIG.GROUND_Y - h;

      obstacles.push({ x, y, w, h, scored: false });
      state.distSinceLast = 0;
      // ë‹¤ìŒ ê°„ê²© ê°±ì‹ 
      randGap = randInt(CONFIG.OBST_MIN_GAP, CONFIG.OBST_MAX_GAP);
    }

    function addScoreIfPassed(ob) {
      // ì¥ì• ë¬¼ì´ ê³µë£¡ì˜ ì˜¤ë¥¸ìª½ì„ ì™„ì „íˆ ì§€ë‚˜ì³¤ì„ ë•Œ í•œë²ˆë§Œ ë“ì 
      if (!ob.scored && ob.x + ob.w < dino.x) {
        ob.scored = true;
        state.score += CONFIG.SCORE_PER_OBSTACLE;
        scoreEl.textContent = `ì ìˆ˜: ${state.score}`;
      }
    }

    function jump() {
      if (!state.running || state.dead) return;
      if (dino.onGround) {
        dino.vy = CONFIG.JUMP_VELOCITY;
        dino.onGround = false;
      }
    }

    // ì´ˆê¸° ìŠ¤í° ê°„ê²©
    let randGap = randInt(CONFIG.OBST_MIN_GAP, CONFIG.OBST_MAX_GAP);

    // ===============================
    // ì…ë ¥
    // ===============================
    window.addEventListener("keydown", (e) => {
      if (e.code === "Space" || e.code === "ArrowUp") {
        e.preventDefault();
        jump();
      }
    }, { passive: false });

    cvs.addEventListener("pointerdown", () => {
      if (state.dead) return; // ì£½ì—ˆì„ ë• ë²„íŠ¼ìœ¼ë¡œë§Œ ì¬ì‹œì‘
      jump();
    });

    restartBtn.addEventListener("click", resetGame);

    // ===============================
    // ë£¨í”„
    // ===============================
    function loop(now) {
      if (!state.running) return;

      const dt = Math.min(0.032, (now - state.lastTime) / 1000); // ìµœëŒ€ 32msë¡œ í´ë¨í”„
      state.lastTime = now;
      state.time += dt;

      // ì†ë„ ê°€ì†
      state.speed = clamp(state.speed + CONFIG.SPEED_ACCEL_PER_SEC * dt, CONFIG.SPEED_START, CONFIG.SPEED_MAX);

      // ë¬¼ë¦¬ ì—…ë°ì´íŠ¸ (ì í”„/ì¤‘ë ¥)
      dino.vy += CONFIG.GRAVITY * dt;
      dino.y += dino.vy * dt;

      // ì§€ë©´ ì¶©ëŒ
      const groundTop = CONFIG.GROUND_Y - dino.h;
      if (dino.y >= groundTop) {
        dino.y = groundTop;
        dino.vy = 0;
        dino.onGround = true;
      }

      // ì¥ì• ë¬¼ ì´ë™/ìŠ¤í°
      state.distSinceLast += state.speed * dt;
      trySpawnObstacle();

      for (let i = obstacles.length - 1; i >= 0; i--) {
        const ob = obstacles[i];
        ob.x -= state.speed * dt;

        addScoreIfPassed(ob);

        // ì¶©ëŒ ì²´í¬ (ì‚¬ê°í˜• íˆíŠ¸ë°•ìŠ¤)
        if (rectsOverlap(dino.x, dino.y, dino.w, dino.h, ob.x, ob.y, ob.w, ob.h)) {
          gameOver();
          render(); // ë§ˆì§€ë§‰ í”„ë ˆì„ ê·¸ë ¤ì£¼ê¸°
          return;
        }

        // í™”ë©´ ë°– ì œê±°
        if (ob.x + ob.w < -50) obstacles.splice(i, 1);
      }

      render();
      requestAnimationFrame(loop);
    }

    // ===============================
    // ë Œë”
    // ===============================
    function render() {
      // ë°°ê²½
      ctx.clearRect(0, 0, CONFIG.GAME_WIDTH, CONFIG.GAME_HEIGHT);
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0, 0, CONFIG.GAME_WIDTH, CONFIG.GAME_HEIGHT);

      // ì§€ë©´ ë¼ì¸
      ctx.strokeStyle = "#ddd";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(0, CONFIG.GROUND_Y + 0.5);
      ctx.lineTo(CONFIG.GAME_WIDTH, CONFIG.GROUND_Y + 0.5);
      ctx.stroke();

      // ê³µë£¡ (ê²€ì • ì§ì‚¬ê°í˜•)
      ctx.fillStyle = CONFIG.DINO_COLOR;
      ctx.fillRect(dino.x, dino.y, dino.w, dino.h);

      // ì¥ì• ë¬¼ (ë¹¨ê°„ ì§ì‚¬ê°í˜•)
      ctx.fillStyle = CONFIG.OBST_COLOR;
      for (const ob of obstacles) {
        ctx.fillRect(ob.x, ob.y, ob.w, ob.h);
      }

      // (ì„ íƒ) ì†ë„ í‘œì‹œ ê°€ì´ë“œ - ë””ë²„ê·¸ ì›í•˜ë©´ ì£¼ì„ í•´ì œ
      // ctx.fillStyle = "#666";
      // ctx.fillText(`speed: ${state.speed.toFixed(0)} px/s`, 12, CONFIG.GAME_HEIGHT - 12);
    }

    // ìµœì´ˆ ì§„ì… ì„¸íŒ…
    highScoreEl.textContent = `ìµœê³ ì : ${state.highScore}`;
    scoreEl.textContent = `ì ìˆ˜: 0`;

    // ë°”ë¡œ ì‹œì‘
    resetGame();
  </script>
</body>
</html>
